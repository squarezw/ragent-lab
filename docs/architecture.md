# RAG Lab 架构设计

## 整体架构

RAG Lab 是一个综合性的 RAG（检索增强生成）工具包，包含文本分块和嵌入模型两个核心功能模块。

## 模块设计

### 1. 文本分块模块 (chunking/)

```
chunking/
├── base.py          # 基础类和工具函数
├── strategies.py    # 12种分块策略实现
└── registry.py      # 策略注册和管理
```

**核心功能：**
- 12种不同的分块策略
- 统一的接口设计
- 参数化配置
- 策略评级系统

### 2. 嵌入模型模块 (embedding/)

```
embedding/
├── base.py          # 嵌入基类和结果类
├── strategies.py    # 多种嵌入模型实现
└── registry.py      # 模型注册和管理
```

**支持的模型类型：**
- OpenAI 嵌入模型
- Sentence Transformers
- HuggingFace 模型
- 领域专用模型

### 3. Web 界面模块 (web/)

```
web/
├── app.py                    # 主应用（双菜单）
├── components.py             # 分块UI组件
├── embedding_app.py          # 嵌入应用
└── embedding_components.py   # 嵌入UI组件
```

**界面特性：**
- 实时参数调整
- 结果可视化
- 模型对比功能

## 交互流程

### 文本分段流程

1. **输入阶段**：用户输入待分段的文本
2. **策略选择**：选择分块策略和参数
3. **处理阶段**：执行分块算法
4. **结果展示**：显示分块结果和统计信息

### Embedding 流程

1. **文本输入**：输入多个待嵌入的句子
2. **模型选择**：选择嵌入模型和参数
3. **生成嵌入**：调用模型生成向量
4. **分析展示**：
   - 向量可视化（2D PCA）
   - 相似度矩阵
   - 相似度分析
   - 模型对比

## 技术栈

### 后端技术
- **Python 3.8+**
- **Streamlit**: Web 界面框架
- **Sentence Transformers**: 嵌入模型
- **OpenAI API**: 商业嵌入服务
- **HuggingFace**: 开源模型库
- **scikit-learn**: 机器学习工具
- **NLTK**: 自然语言处理

### 前端技术
- **Streamlit**: 响应式 Web 界面
- **Plotly**: 数据可视化
- **Pandas**: 数据处理

## 扩展性设计

### 1. 策略注册系统
- 统一的策略接口
- 动态注册新策略
- 参数化配置
- 评级系统

### 2. 模型注册系统
- 统一的模型接口
- 支持多种模型类型
- 参数化配置
- 元数据管理

### 3. 组件化设计
- 可复用的 UI 组件
- 模块化的功能设计
- 清晰的职责分离

## 性能优化

### 1. 模型缓存
- 模型实例缓存
- 避免重复加载

### 2. 批处理
- 支持批量文本处理
- 提高处理效率

### 3. 异步处理
- 长时间任务的异步处理
- 用户体验优化

## 部署方案

### 1. 本地开发
```bash
streamlit run src/ragent_lab/web/app.py
```

### 2. Docker 部署
```bash
docker-compose up
```

### 3. 云部署
- 支持各种云平台
- 容器化部署
- 环境变量配置

## 未来扩展

### 1. 更多分块策略
- 基于图的分块
- 自适应分块
- 多模态分块

### 2. 更多嵌入模型
- 更多商业模型
- 自定义模型
- 模型微调

### 3. 高级功能
- 分块质量评估
- 嵌入质量分析
- 端到端 RAG 流程
